<!doctype html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <title>Do our projects build?</title> 
        <style> 
            body, html {
                height: 100%;
            }
            body {
                padding: 0;
                margin: 0;
                color: #FFF;
                font-family: "Trebuchet MS", sans-serif;
                font-size: 12px;
                text-align: center;
                padding-top: 100px;
            }
            
            body.success {
                background: #234F32;
                background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #092E20), color-stop(1, #234F32));
                background-image: -moz-linear-gradient(center bottom, #092E20 0%, #234F32 100%);
            }
            
            body.fail {
                background: red;
            }

            body.running {
                background: blue;
            }
            
            #answer {
                font-weight: bold;
                font-size: 200px;
                text-shadow: #000 0 1px 3px;
                text-rendering: optimizeLegibility;
            }
            a {
                color: #FFC757;
                text-decoration: none;
            }
        </style> 
    </head> 
    <body class="running" id="body">
        <h1>Do our projects build?</h1>
        <div id="answer">Let me check!</div>
        
        <script src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.1/mootools-yui-compressed.js"></script>
        <script src="more.js"></script>
        <script>
        window.addEvent('domready', function() {

            var JENKINS_URL = 'http://ci.django-cms.org';

            var TEXT = {
                OK: "YES!",
                FAIL: "NO!",
                RUNNING: "Running..."
            };
            
            var CLASSES = {
                OK: "success",
                FAIL: "fail",
                RUNNING: "running"
            }

            var answer = $('answer');
            var body = $('body');
            var regex = /_anime$/;
                            
            function getStatusProjects(jobs){
                var fails = [];
                var buildStatus = "OK";
                jobs.each(function (job){
                    if (job.color != "blue"){
                        if (job.color.test(regex)){
                            if (buildStatus == "OK"){
                                buildStatus = "RUNNING";
                            }
                        } else {
                            fails.push(job);
                            buildStatus = "FAIL";
                        }
                    }
                });
                return {
                    fails: fails,
                    buildStatus: buildStatus
                };
            }

            function update(jobs){
                var projectStatus = getStatusProjects(jobs);
                answer.set('text', TEXT[projectStatus.buildStatus]);
                body.set('class', CLASSES[projectStatus.buildStatus]);
            }

            function check(){
                new Request.JSONP({
                    url: JENKINS_URL + '/api/json',
                    callbackKey: 'jsonp',
                    onSuccess: function(data){
                        update(data.jobs);
                    }
                }).send();
            }

            check();
            check.periodical(5000);
        });
        </script>        
    </body> 
</html> 
